<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hero Class - Dashboard Giáo Viên</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .sidebar {
            width: 250px;
            transition: all 0.3s;
        }
        .main-content {
            margin-left: 250px;
            transition: all 0.3s;
        }
        .course-card {
            transition: transform 0.3s ease;
        }
        .course-card:hover {
            transform: translateY(-5px);
        }
        .progress-bar {
            height: 8px;
            border-radius: 4px;
            background-color: #e2e8f0;
        }
        .progress-bar-fill {
            height: 100%;
            border-radius: 4px;
            background-color: #4f46e5;
            transition: width 0.3s ease;
        }
    </style>
</head>
<body class="bg-gray-100">
    <!-- Sidebar -->
    <div class="sidebar fixed h-screen bg-white shadow-md">
        <div class="p-4 border-b">
            <h1 class="text-2xl font-bold text-indigo-600">Hero Class</h1>
        </div>
        <nav class="p-4">
            <ul class="space-y-2">
                <li>
                    <a href="#" class="flex items-center space-x-2 text-gray-700 hover:text-indigo-600 hover:bg-gray-100 p-2 rounded-lg">
                        <i class="fas fa-home"></i>
                        <span>Trang chủ</span>
                    </a>
                </li>
                <li>
                    <a href="#courses" class="flex items-center space-x-2 text-gray-700 hover:text-indigo-600 hover:bg-gray-100 p-2 rounded-lg">
                        <i class="fas fa-book"></i>
                        <span>Khóa học của tôi</span>
                    </a>
                </li>
                <li>
                    <a href="#students" class="flex items-center space-x-2 text-gray-700 hover:text-indigo-600 hover:bg-gray-100 p-2 rounded-lg">
                        <i class="fas fa-users"></i>
                        <span>Học sinh</span>
                    </a>
                </li>
                <li>
                    <a href="#assignments" class="flex items-center space-x-2 text-gray-700 hover:text-indigo-600 hover:bg-gray-100 p-2 rounded-lg">
                        <i class="fas fa-tasks"></i>
                        <span>Bài tập</span>
                    </a>
                </li>
                <li>
                    <a href="#chat" class="flex items-center space-x-2 text-gray-700 hover:text-indigo-600 hover:bg-gray-100 p-2 rounded-lg">
                        <i class="fas fa-comments"></i>
                        <span>Tin nhắn</span>
                    </a>
                </li>
            </ul>
        </nav>
        <div class="absolute bottom-0 w-full p-4 border-t">
            <button onclick="logout()" class="w-full flex items-center space-x-2 text-gray-700 hover:text-red-600 p-2 rounded-lg">
                <i class="fas fa-sign-out-alt"></i>
                <span>Đăng xuất</span>
            </button>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content p-8">
        <!-- Header -->
        <div class="flex justify-between items-center mb-8">
            <h2 class="text-3xl font-bold">Xin chào, <span id="teacherName">Giáo Viên</span>!</h2>
            <div class="flex items-center space-x-4">
                <div class="relative">
                    <button class="flex items-center space-x-2 text-gray-700">
                        <i class="fas fa-bell"></i>
                        <span class="bg-red-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs">5</span>
                    </button>
                </div>
                <div class="flex items-center space-x-2">
                    <img src="https://via.placeholder.com/40" alt="Avatar" class="w-10 h-10 rounded-full">
                    <span class="font-semibold" id="teacherNameShort">GV</span>
                </div>
            </div>
        </div>

        <!-- Quick Stats -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="text-3xl font-bold text-indigo-600 mb-2">12</div>
                <div class="text-gray-600">Khóa học đang dạy</div>
            </div>
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="text-3xl font-bold text-green-600 mb-2">150</div>
                <div class="text-gray-600">Học sinh</div>
            </div>
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="text-3xl font-bold text-yellow-600 mb-2">45</div>
                <div class="text-gray-600">Bài tập chờ chấm</div>
            </div>
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="text-3xl font-bold text-red-600 mb-2">8</div>
                <div class="text-gray-600">Tin nhắn mới</div>
            </div>
        </div>

        <!-- Courses Section -->
        <section id="courses" class="mb-12">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold">Khóa học của tôi</h3>
                <button onclick="openCreateCourseModal()" class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700">
                    <i class="fas fa-plus mr-2"></i> Tạo khóa học mới
                </button>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="coursesContainer">
                <!-- Course Card 1 -->
                <div class="course-card bg-white rounded-lg shadow-md overflow-hidden">
                    <div class="h-40 bg-gradient-to-r from-blue-500 to-blue-600 flex items-center justify-center">
                        <i class="fas fa-calculator text-white text-6xl"></i>
                    </div>
                    <div class="p-6">
                        <h4 class="text-xl font-bold mb-2">Toán lớp 3</h4>
                        <p class="text-gray-600 mb-4">Học các phép tính cơ bản và giải toán</p>
                        <div class="flex justify-between space-x-2">
                            <button onclick="openEditCourseModal('math3')" class="flex-1 bg-indigo-600 text-white py-2 rounded-lg hover:bg-indigo-700">
                                <i class="fas fa-edit mr-2"></i> Chỉnh sửa
                            </button>
                            <button onclick="openDeleteCourseModal('math3')" class="flex-1 bg-red-600 text-white py-2 rounded-lg hover:bg-red-700">
                                <i class="fas fa-trash mr-2"></i> Xóa
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Course Card 2 -->
                <div class="course-card bg-white rounded-lg shadow-md overflow-hidden">
                    <div class="h-40 bg-gradient-to-r from-green-500 to-green-600 flex items-center justify-center">
                        <i class="fas fa-book-open text-white text-6xl"></i>
                    </div>
                    <div class="p-6">
                        <h4 class="text-xl font-bold mb-2">Tiếng Việt lớp 3</h4>
                        <p class="text-gray-600 mb-4">Rèn luyện kỹ năng đọc viết</p>
                        <div class="flex justify-between space-x-2">
                            <button onclick="openEditCourseModal('literature3')" class="flex-1 bg-indigo-600 text-white py-2 rounded-lg hover:bg-indigo-700">
                                <i class="fas fa-edit mr-2"></i> Chỉnh sửa
                            </button>
                            <button onclick="openDeleteCourseModal('literature3')" class="flex-1 bg-red-600 text-white py-2 rounded-lg hover:bg-red-700">
                                <i class="fas fa-trash mr-2"></i> Xóa
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Students Section -->
        <section id="students" class="mb-12">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold">Học sinh của tôi</h3>
                <button onclick="openAddStudentModal()" class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700">
                    <i class="fas fa-user-plus mr-2"></i> Thêm học sinh
                </button>
            </div>
            <div class="bg-white rounded-lg shadow-md overflow-hidden">
                <div class="p-4 border-b">
                    <input type="text" placeholder="Tìm kiếm học sinh..." class="w-full px-4 py-2 border rounded-lg">
                </div>
                <table class="min-w-full">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Học sinh</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Khóa học</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tiến độ</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Điểm trung bình</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Thao tác</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                        <!-- Dữ liệu mẫu sẽ bị thay thế bởi dữ liệu từ Firestore khi trang tải -->
                        <!-- Chỉ để hiển thị cấu trúc -->
                        <tr>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="flex items-center">
                                    <img src="https://via.placeholder.com/40" alt="Avatar" class="w-8 h-8 rounded-full mr-3">
                                    <span>Nguyễn Văn A (Mẫu)</span>
                                </div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">Toán lớp 3</td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="progress-bar">
                                    <div class="progress-bar-fill" style="width: 75%"></div>
                                </div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">8.5</td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <button onclick="openEditStudentModal('student1')" class="text-indigo-600 hover:text-indigo-900 mr-3">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button onclick="openDeleteStudentModal('student1')" class="text-red-600 hover:text-red-900 mr-3">
                                    <i class="fas fa-trash"></i>
                                </button>
                                <button class="text-indigo-600 hover:text-indigo-900 mr-3">
                                    <i class="fas fa-chart-line"></i>
                                </button>
                                <button class="text-green-600 hover:text-green-900">
                                    <i class="fas fa-comment"></i>
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Assignments Section -->
        <section id="assignments" class="mb-12">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold">Bài tập</h3>
                <button onclick="openCreateAssignmentModal()" class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700">
                    <i class="fas fa-plus mr-2"></i> Tạo bài tập mới
                </button>
            </div>
            <div class="bg-white rounded-lg shadow-md overflow-hidden">
                <table class="min-w-full">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Bài tập</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Khóa học</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Hạn nộp</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Đã nộp/Chưa nộp</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Thao tác</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                        <!-- Dữ liệu mẫu sẽ bị thay thế bởi dữ liệu từ Firestore khi trang tải -->
                        <!-- Chỉ để hiển thị cấu trúc -->
                        <tr>
                            <td class="px-6 py-4 whitespace-nowrap">Bài tập Toán tuần 3 (Mẫu)</td>
                            <td class="px-6 py-4 whitespace-nowrap">Toán lớp 3</td>
                            <td class="px-6 py-4 whitespace-nowrap">15/03/2024</td>
                            <td class="px-6 py-4 whitespace-nowrap">12/15</td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <button onclick="alert('Đây là bài tập mẫu, không thể chỉnh sửa')" class="text-indigo-600 hover:text-indigo-900 mr-3">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button onclick="alert('Đây là bài tập mẫu, không thể xóa')" class="text-red-600 hover:text-red-900">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>
    </div>

    <!-- Create Course Modal -->
    <div id="createCourseModal" class="fixed inset-0 bg-black bg-opacity-50 hidden">
        <div class="flex items-center justify-center min-h-screen">
            <div class="bg-white p-8 rounded-lg w-full max-w-2xl">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold">Tạo khóa học mới</h2>
                    <button class="text-gray-500 hover:text-gray-700" onclick="closeCreateCourseModal()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <form id="createCourseForm">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-gray-700 mb-2">Tên khóa học</label>
                            <input type="text" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:border-indigo-600" required>
                        </div>
                        <div>
                            <label class="block text-gray-700 mb-2">Môn học</label>
                            <select class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:border-indigo-600" required>
                                <option value="">Chọn môn học</option>
                                <option value="math">Toán</option>
                                <option value="literature">Tiếng Việt</option>
                                <option value="science">Tự nhiên và Xã hội</option>
                                <option value="english">Tiếng Anh</option>
                                <option value="ethics">Đạo Đức</option>
                            </select>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-gray-700 mb-2">Lớp</label>
                            <select class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:border-indigo-600" required>
                                <option value="">Chọn lớp</option>
                                <option value="1">Lớp 1</option>
                                <option value="2">Lớp 2</option>
                                <option value="3">Lớp 3</option>
                                <option value="4">Lớp 4</option>
                                <option value="5">Lớp 5</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-gray-700 mb-2">Hình ảnh khóa học</label>
                            <input type="file" accept="image/*" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:border-indigo-600">
                        </div>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 mb-2">Mô tả khóa học</label>
                        <textarea class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:border-indigo-600" rows="3"></textarea>
                    </div>

                    <!-- Tài liệu và Video -->
                    <div class="mb-6">
                        <h3 class="text-lg font-semibold mb-4">Tài liệu và Video</h3>
                        
                        <!-- Tài liệu -->
                        <div class="mb-4">
                            <label class="block text-gray-700 mb-2">Tải lên tài liệu</label>
                            <div class="border-2 border-dashed border-gray-300 rounded-lg p-4">
                                <div class="flex flex-col items-center">
                                    <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-2"></i>
                                    <p class="text-gray-600 mb-2">Kéo thả tài liệu vào đây hoặc</p>
                                    <label class="bg-indigo-600 text-white px-4 py-2 rounded-lg cursor-pointer hover:bg-indigo-700">
                                        <input type="file" class="hidden" multiple accept=".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.txt,.zip,.rar">
                                        Chọn tài liệu
                                    </label>
                                    <p class="text-sm text-gray-500 mt-2">Hỗ trợ: PDF, DOC, DOCX, XLS, XLSX, PPT, PPTX, TXT, ZIP, RAR</p>
                                </div>
                            </div>
                        </div>

                        <!-- Video -->
                        <div class="mb-4">
                            <label class="block text-gray-700 mb-2">Tải lên video</label>
                            <div class="border-2 border-dashed border-gray-300 rounded-lg p-4">
                                <div class="flex flex-col items-center">
                                    <i class="fas fa-video text-4xl text-gray-400 mb-2"></i>
                                    <p class="text-gray-600 mb-2">Kéo thả video vào đây hoặc</p>
                                    <label class="bg-indigo-600 text-white px-4 py-2 rounded-lg cursor-pointer hover:bg-indigo-700">
                                        <input type="file" class="hidden" accept="video/*">
                                        Chọn video
                                    </label>
                                    <p class="text-sm text-gray-500 mt-2">Hỗ trợ: MP4, AVI, MOV, WMV</p>
                                </div>
                            </div>
                        </div>

                        <!-- Google Drive -->
                        <div class="mb-4">
                            <label class="block text-gray-700 mb-2">Liên kết Google Drive</label>
                            <div class="flex space-x-2">
                                <input type="text" placeholder="Dán liên kết Google Drive" class="flex-1 px-4 py-2 border rounded-lg focus:outline-none focus:border-indigo-600">
                                <button type="button" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700">
                                    <i class="fab fa-google-drive mr-2"></i> Thêm
                                </button>
                            </div>
                        </div>

                        <!-- Google Forms -->
                        <div class="mb-4">
                            <label class="block text-gray-700 mb-2">Liên kết Google Forms</label>
                            <div class="flex space-x-2">
                                <input type="text" placeholder="Dán liên kết Google Forms" class="flex-1 px-4 py-2 border rounded-lg focus:outline-none focus:border-indigo-600">
                                <button type="button" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700">
                                    <i class="fab fa-google mr-2"></i> Thêm
                                </button>
                            </div>
                        </div>
                    </div>

                    <button type="submit" class="w-full bg-indigo-600 text-white py-2 rounded-lg hover:bg-indigo-700">
                        Tạo khóa học
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Create Assignment Modal -->
    <div id="createAssignmentModal" class="fixed inset-0 bg-black bg-opacity-50 hidden">
        <div class="flex items-center justify-center min-h-screen">
            <div class="bg-white p-8 rounded-lg w-full max-w-4xl">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold">Tạo bài tập mới</h2>
                    <button class="text-gray-500 hover:text-gray-700" onclick="closeCreateAssignmentModal()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <form id="createAssignmentForm">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-gray-700 mb-2">Tên bài tập</label>
                            <input type="text" name="name" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:border-indigo-600" required>
                        </div>
                        <div>
                            <label class="block text-gray-700 mb-2">Khóa học</label>
                            <select name="courseId" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:border-indigo-600" required>
                                <option value="">Chọn khóa học</option>
                            </select>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-gray-700 mb-2">Hạn nộp</label>
                            <input type="datetime-local" name="dueDate" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:border-indigo-600" required>
                        </div>
                        <div>
                            <label class="block text-gray-700 mb-2">Loại bài tập</label>
                            <select name="type" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:border-indigo-600" required>
                                <option value="document">Tài liệu</option>
                                <option value="quiz">Trắc nghiệm</option>
                                <option value="video">Video</option>
                                <option value="form">Google Form</option>
                            </select>
                        </div>
                    </div>

                    <!-- Nội dung bài tập -->
                    <div class="mb-4">
                        <label class="block text-gray-700 mb-2">Nội dung bài tập</label>
                        <textarea name="content" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:border-indigo-600" rows="5"></textarea>
                    </div>

                    <!-- Tài liệu -->
                    <div class="mb-4" id="documentSection">
                        <label class="block text-gray-700 mb-2">Tải lên tài liệu</label>
                        <div class="border-2 border-dashed border-gray-300 rounded-lg p-4">
                            <div class="flex flex-col items-center">
                                <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-2"></i>
                                <p class="text-gray-600 mb-2">Kéo thả tài liệu vào đây hoặc</p>
                                <label class="bg-indigo-600 text-white px-4 py-2 rounded-lg cursor-pointer hover:bg-indigo-700">
                                    <input type="file" name="documents" class="hidden" multiple accept=".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.txt,.zip,.rar">
                                    Chọn tài liệu
                                </label>
                                <p class="text-sm text-gray-500 mt-2">Hỗ trợ: PDF, DOC, DOCX, XLS, XLSX, PPT, PPTX, TXT, ZIP, RAR</p>
                            </div>
                        </div>
                    </div>

                    <!-- Video -->
                    <div class="mb-4 hidden" id="videoSection">
                        <label class="block text-gray-700 mb-2">Tải lên video</label>
                        <div class="border-2 border-dashed border-gray-300 rounded-lg p-4">
                            <div class="flex flex-col items-center">
                                <i class="fas fa-video text-4xl text-gray-400 mb-2"></i>
                                <p class="text-gray-600 mb-2">Kéo thả video vào đây hoặc</p>
                                <label class="bg-indigo-600 text-white px-4 py-2 rounded-lg cursor-pointer hover:bg-indigo-700">
                                    <input type="file" name="video" class="hidden" accept="video/*">
                                    Chọn video
                                </label>
                                <p class="text-sm text-gray-500 mt-2">Hỗ trợ: MP4, AVI, MOV, WMV</p>
                            </div>
                        </div>
                    </div>

                    <!-- Google Drive -->
                    <div class="mb-4">
                        <label class="block text-gray-700 mb-2">Liên kết Google Drive</label>
                        <div class="flex space-x-2">
                            <input type="text" name="driveLink" placeholder="Dán liên kết Google Drive" class="flex-1 px-4 py-2 border rounded-lg focus:outline-none focus:border-indigo-600">
                            <button type="button" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700" onclick="addDriveLink()">
                                <i class="fab fa-google-drive mr-2"></i> Thêm
                            </button>
                        </div>
                    </div>

                    <!-- Google Forms -->
                    <div class="mb-4 hidden" id="formSection">
                        <label class="block text-gray-700 mb-2">Liên kết Google Forms</label>
                        <div class="flex space-x-2">
                            <input type="text" name="formLink" placeholder="Dán liên kết Google Forms" class="flex-1 px-4 py-2 border rounded-lg focus:outline-none focus:border-indigo-600">
                            <button type="button" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700" onclick="addFormLink()">
                                <i class="fab fa-google mr-2"></i> Thêm
                            </button>
                        </div>
                    </div>

                    <!-- Trắc nghiệm -->
                    <div class="mb-4 hidden" id="quizSection">
                        <label class="block text-gray-700 mb-2">Tạo câu hỏi trắc nghiệm</label>
                        <div id="quizQuestions" class="space-y-4">
                            <!-- Câu hỏi mẫu -->
                            <div class="border rounded-lg p-4">
                                <div class="flex justify-between items-center mb-2">
                                    <h3 class="font-semibold">Câu hỏi 1</h3>
                                    <button type="button" class="text-red-600 hover:text-red-800" onclick="removeQuestion(this)">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                                <input type="text" placeholder="Nhập câu hỏi" class="w-full px-4 py-2 border rounded-lg mb-2">
                                <div class="space-y-2">
                                    <div class="flex items-center">
                                        <input type="radio" name="answer1" class="mr-2">
                                        <input type="text" placeholder="Đáp án A" class="flex-1 px-4 py-2 border rounded-lg">
                                    </div>
                                    <div class="flex items-center">
                                        <input type="radio" name="answer1" class="mr-2">
                                        <input type="text" placeholder="Đáp án B" class="flex-1 px-4 py-2 border rounded-lg">
                                    </div>
                                    <div class="flex items-center">
                                        <input type="radio" name="answer1" class="mr-2">
                                        <input type="text" placeholder="Đáp án C" class="flex-1 px-4 py-2 border rounded-lg">
                                    </div>
                                    <div class="flex items-center">
                                        <input type="radio" name="answer1" class="mr-2">
                                        <input type="text" placeholder="Đáp án D" class="flex-1 px-4 py-2 border rounded-lg">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <button type="button" class="mt-2 bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700" onclick="addQuestion()">
                            <i class="fas fa-plus mr-2"></i> Thêm câu hỏi
                        </button>
                    </div>

                    <button type="submit" class="w-full bg-indigo-600 text-white py-2 rounded-lg hover:bg-indigo-700">
                        Tạo bài tập
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Add Student Modal -->
    <div id="addStudentModal" class="fixed inset-0 bg-black bg-opacity-50 hidden">
        <div class="flex items-center justify-center min-h-screen">
            <div class="bg-white p-8 rounded-lg w-full max-w-md">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold">Thêm học sinh vào khóa học</h2>
                    <button class="text-gray-500 hover:text-gray-700" onclick="closeAddStudentModal()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <form id="addStudentForm">
                    <div class="mb-4">
                        <label class="block text-gray-700 mb-2">Khóa học</label>
                        <select id="courseSelect" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:border-indigo-600" required>
                            <option value="">Chọn khóa học</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 mb-2">Tìm kiếm học sinh</label>
                        <div class="relative">
                            <input type="text" id="studentSearch" placeholder="Nhập tên hoặc email học sinh" 
                                class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:border-indigo-600">
                            <div id="searchResults" class="absolute z-10 w-full mt-1 bg-white border rounded-lg shadow-lg hidden">
                                <!-- Search results will be added here -->
                            </div>
                        </div>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 mb-2">Học sinh đã chọn</label>
                        <div id="selectedStudents" class="border rounded-lg p-2 min-h-[100px]">
                            <!-- Selected students will be added here -->
                        </div>
                    </div>
                    <button type="submit" class="w-full bg-indigo-600 text-white py-2 rounded-lg hover:bg-indigo-700">
                        Thêm học sinh
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Edit Course Modal -->
    <div id="editCourseModal" class="fixed inset-0 bg-black bg-opacity-50 hidden">
        <div class="flex items-center justify-center min-h-screen">
            <div class="bg-white p-8 rounded-lg w-full max-w-2xl">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold">Chỉnh sửa khóa học</h2>
                    <button class="text-gray-500 hover:text-gray-700" onclick="closeEditCourseModal()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <form id="editCourseForm">
                    <input type="hidden" id="editCourseId">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-gray-700 mb-2">Tên khóa học</label>
                            <input type="text" id="editCourseName" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:border-indigo-600" required>
                        </div>
                        <div>
                            <label class="block text-gray-700 mb-2">Môn học</label>
                            <select id="editCourseSubject" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:border-indigo-600" required>
                                <option value="">Chọn môn học</option>
                                <option value="math">Toán</option>
                                <option value="literature">Tiếng Việt</option>
                                <option value="science">Tự nhiên và Xã hội</option>
                                <option value="english">Tiếng Anh</option>
                                <option value="ethics">Đạo Đức</option>
                            </select>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-gray-700 mb-2">Lớp</label>
                            <select id="editCourseGrade" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:border-indigo-600" required>
                                <option value="">Chọn lớp</option>
                                <option value="1">Lớp 1</option>
                                <option value="2">Lớp 2</option>
                                <option value="3">Lớp 3</option>
                                <option value="4">Lớp 4</option>
                                <option value="5">Lớp 5</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-gray-700 mb-2">Hình ảnh khóa học</label>
                            <input type="file" id="editCourseImage" accept="image/*" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:border-indigo-600">
                        </div>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 mb-2">Mô tả khóa học</label>
                        <textarea id="editCourseDescription" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:border-indigo-600" rows="3"></textarea>
                    </div>
                    <button type="submit" class="w-full bg-indigo-600 text-white py-2 rounded-lg hover:bg-indigo-700">
                        Lưu thay đổi
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Delete Course Confirmation Modal -->
    <div id="deleteCourseModal" class="fixed inset-0 bg-black bg-opacity-50 hidden">
        <div class="flex items-center justify-center min-h-screen">
            <div class="bg-white p-8 rounded-lg w-full max-w-md">
                <div class="text-center">
                    <i class="fas fa-exclamation-triangle text-red-500 text-5xl mb-4"></i>
                    <h2 class="text-2xl font-bold mb-4">Xác nhận xóa khóa học</h2>
                    <p class="text-gray-600 mb-6">Bạn có chắc chắn muốn xóa khóa học này? Hành động này không thể hoàn tác.</p>
                    <div class="flex justify-center space-x-4">
                        <button onclick="closeDeleteCourseModal()" class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-100">
                            Hủy
                        </button>
                        <button onclick="confirmDeleteCourse()" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700">
                            Xóa
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Assignment Modal -->
    <div id="editAssignmentModal" class="fixed inset-0 bg-black bg-opacity-50 hidden">
        <div class="flex items-center justify-center min-h-screen">
            <div class="bg-white p-8 rounded-lg w-full max-w-4xl">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold">Chỉnh sửa bài tập</h2>
                    <button class="text-gray-500 hover:text-gray-700" onclick="closeEditAssignmentModal()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <form id="editAssignmentForm">
                    <input type="hidden" id="editAssignmentId">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-gray-700 mb-2">Tên bài tập</label>
                            <input type="text" id="editAssignmentName" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:border-indigo-600" required>
                        </div>
                        <div>
                            <label class="block text-gray-700 mb-2">Khóa học</label>
                            <select id="editAssignmentCourse" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:border-indigo-600" required>
                                <option value="">Chọn khóa học</option>
                            </select>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-gray-700 mb-2">Hạn nộp</label>
                            <input type="datetime-local" id="editAssignmentDueDate" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:border-indigo-600" required>
                        </div>
                        <div>
                            <label class="block text-gray-700 mb-2">Loại bài tập</label>
                            <select id="editAssignmentType" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:border-indigo-600" required>
                                <option value="document">Tài liệu</option>
                                <option value="quiz">Trắc nghiệm</option>
                                <option value="video">Video</option>
                                <option value="form">Google Form</option>
                            </select>
                        </div>
                    </div>

                    <!-- Nội dung bài tập -->
                    <div class="mb-4">
                        <label class="block text-gray-700 mb-2">Nội dung bài tập</label>
                        <textarea id="editAssignmentContent" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:border-indigo-600" rows="5"></textarea>
                    </div>

                    <!-- Tài liệu -->
                    <div class="mb-4" id="editDocumentSection">
                        <label class="block text-gray-700 mb-2">Tài liệu hiện tại</label>
                        <div id="currentFiles" class="mb-4">
                            <!-- Current files will be listed here -->
                        </div>
                        <label class="block text-gray-700 mb-2">Thêm tài liệu mới</label>
                        <div class="border-2 border-dashed border-gray-300 rounded-lg p-4">
                            <div class="flex flex-col items-center">
                                <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-2"></i>
                                <p class="text-gray-600 mb-2">Kéo thả tài liệu vào đây hoặc</p>
                                <label class="bg-indigo-600 text-white px-4 py-2 rounded-lg cursor-pointer hover:bg-indigo-700">
                                    <input type="file" name="newDocuments" class="hidden" multiple accept=".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.txt,.zip,.rar">
                                    Chọn tài liệu
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Video -->
                    <div class="mb-4 hidden" id="editVideoSection">
                        <label class="block text-gray-700 mb-2">Video hiện tại</label>
                        <div id="currentVideo" class="mb-4">
                            <!-- Current video will be listed here -->
                        </div>
                        <label class="block text-gray-700 mb-2">Thêm video mới</label>
                        <div class="border-2 border-dashed border-gray-300 rounded-lg p-4">
                            <div class="flex flex-col items-center">
                                <i class="fas fa-video text-4xl text-gray-400 mb-2"></i>
                                <p class="text-gray-600 mb-2">Kéo thả video vào đây hoặc</p>
                                <label class="bg-indigo-600 text-white px-4 py-2 rounded-lg cursor-pointer hover:bg-indigo-700">
                                    <input type="file" name="newVideo" class="hidden" accept="video/*">
                                    Chọn video
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Google Drive -->
                    <div class="mb-4">
                        <label class="block text-gray-700 mb-2">Liên kết Google Drive</label>
                        <div class="flex space-x-2">
                            <input type="text" id="editDriveLink" placeholder="Dán liên kết Google Drive" class="flex-1 px-4 py-2 border rounded-lg focus:outline-none focus:border-indigo-600">
                            <button type="button" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700" onclick="updateDriveLink()">
                                <i class="fab fa-google-drive mr-2"></i> Cập nhật
                            </button>
                        </div>
                    </div>

                    <!-- Google Forms -->
                    <div class="mb-4 hidden" id="editFormSection">
                        <label class="block text-gray-700 mb-2">Liên kết Google Forms</label>
                        <div class="flex space-x-2">
                            <input type="text" id="editFormLink" placeholder="Dán liên kết Google Forms" class="flex-1 px-4 py-2 border rounded-lg focus:outline-none focus:border-indigo-600">
                            <button type="button" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700" onclick="updateFormLink()">
                                <i class="fab fa-google mr-2"></i> Cập nhật
                            </button>
                        </div>
                    </div>

                    <!-- Trắc nghiệm -->
                    <div class="mb-4 hidden" id="editQuizSection">
                        <label class="block text-gray-700 mb-2">Chỉnh sửa câu hỏi trắc nghiệm</label>
                        <div id="editQuizQuestions" class="space-y-4">
                            <!-- Quiz questions will be loaded here -->
                        </div>
                        <button type="button" class="mt-2 bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700" onclick="addEditQuestion()">
                            <i class="fas fa-plus mr-2"></i> Thêm câu hỏi
                        </button>
                    </div>

                    <button type="submit" class="w-full bg-indigo-600 text-white py-2 rounded-lg hover:bg-indigo-700">
                        Lưu thay đổi
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Delete Assignment Confirmation Modal -->
    <div id="deleteAssignmentModal" class="fixed inset-0 bg-black bg-opacity-50 hidden">
        <div class="flex items-center justify-center min-h-screen">
            <div class="bg-white p-8 rounded-lg w-full max-w-md">
                <div class="text-center">
                    <i class="fas fa-exclamation-triangle text-red-500 text-5xl mb-4"></i>
                    <h2 class="text-2xl font-bold mb-4">Xác nhận xóa bài tập</h2>
                    <p class="text-gray-600 mb-6">Bạn có chắc chắn muốn xóa bài tập này? Hành động này không thể hoàn tác.</p>
                    <div class="flex justify-center space-x-4">
                        <button onclick="closeDeleteAssignmentModal()" class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-100">
                            Hủy
                        </button>
                        <button onclick="confirmDeleteAssignment()" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700">
                            Xóa
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Student Modal -->
    <div id="editStudentModal" class="fixed inset-0 bg-black bg-opacity-50 hidden">
        <div class="flex items-center justify-center min-h-screen">
            <div class="bg-white p-8 rounded-lg w-full max-w-md">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold">Chỉnh sửa thông tin học sinh</h2>
                    <button class="text-gray-500 hover:text-gray-700" onclick="closeEditStudentModal()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <form id="editStudentForm">
                    <input type="hidden" id="editStudentId">
                    <div class="mb-4">
                        <label class="block text-gray-700 mb-2">Họ và tên</label>
                        <input type="text" id="editStudentName" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:border-indigo-600" required>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 mb-2">Email</label>
                        <input type="email" id="editStudentEmail" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:border-indigo-600" required>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 mb-2">Lớp</label>
                        <select id="editStudentGrade" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:border-indigo-600" required>
                            <option value="">Chọn lớp</option>
                            <option value="1">Lớp 1</option>
                            <option value="2">Lớp 2</option>
                            <option value="3">Lớp 3</option>
                            <option value="4">Lớp 4</option>
                            <option value="5">Lớp 5</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 mb-2">Trạng thái</label>
                        <select id="editStudentStatus" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:border-indigo-600" required>
                            <option value="active">Đang học</option>
                            <option value="inactive">Tạm nghỉ</option>
                            <option value="completed">Đã hoàn thành</option>
                        </select>
                    </div>
                    <button type="submit" class="w-full bg-indigo-600 text-white py-2 rounded-lg hover:bg-indigo-700">
                        Lưu thay đổi
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Delete Student Confirmation Modal -->
    <div id="deleteStudentModal" class="fixed inset-0 bg-black bg-opacity-50 hidden">
        <div class="flex items-center justify-center min-h-screen">
            <div class="bg-white p-8 rounded-lg w-full max-w-md">
                <div class="text-center">
                    <i class="fas fa-exclamation-triangle text-red-500 text-5xl mb-4"></i>
                    <h2 class="text-2xl font-bold mb-4">Xác nhận xóa học sinh</h2>
                    <p class="text-gray-600 mb-6">Bạn có chắc chắn muốn xóa học sinh này khỏi khóa học? Hành động này không thể hoàn tác.</p>
                    <div class="flex justify-center space-x-4">
                        <button onclick="closeDeleteStudentModal()" class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-100">
                            Hủy
                        </button>
                        <button onclick="confirmDeleteStudent()" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700">
                            Xóa
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_AUTH_DOMAIN",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_STORAGE_BUCKET",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);

        // Check authentication
        firebase.auth().onAuthStateChanged((user) => {
            if (user) {
                // User is signed in
                const userRef = firebase.firestore().collection('users').doc(user.uid);
                userRef.get().then((doc) => {
                    if (doc.exists) {
                        const userData = doc.data();
                        if (userData.role !== 'teacher') {
                            // Redirect to appropriate dashboard
                            window.location.href = userData.role + '-dashboard.html';
                        } else {
                            // Update UI with user data
                            document.getElementById('teacherName').textContent = userData.name;
                            document.getElementById('teacherNameShort').textContent = userData.name.charAt(0);
                        }
                    }
                });
            } else {
                // User is signed out
                window.location.href = 'index.html';
            }
        });

        // Logout function
        function logout() {
            firebase.auth().signOut().then(() => {
                window.location.href = 'index.html';
            }).catch((error) => {
                console.error('Logout error:', error);
            });
        }

        // Modal functions
        function openCreateCourseModal() {
            document.getElementById('createCourseModal').classList.remove('hidden');
        }

        function closeCreateCourseModal() {
            document.getElementById('createCourseModal').classList.add('hidden');
        }

        function openCreateAssignmentModal() {
            document.getElementById('createAssignmentModal').classList.remove('hidden');
        }

        function closeCreateAssignmentModal() {
            document.getElementById('createAssignmentModal').classList.add('hidden');
        }

        // Form submissions
        document.getElementById('createCourseForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const courseData = {
                name: e.target[0].value,
                subject: e.target[1].value,
                grade: e.target[2].value,
                description: e.target[3].value,
                teacherId: firebase.auth().currentUser.uid,
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            };

            try {
                await firebase.firestore().collection('courses').add(courseData);
                closeCreateCourseModal();
                // Refresh courses list
                loadCourses();
            } catch (error) {
                console.error('Error creating course:', error);
                alert('Có lỗi xảy ra khi tạo khóa học');
            }
        });

        document.getElementById('createAssignmentForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const assignmentData = {
                name: formData.get('name'),
                courseId: formData.get('courseId'),
                dueDate: new Date(formData.get('dueDate')),
                type: formData.get('type'),
                content: formData.get('content'),
                teacherId: firebase.auth().currentUser.uid,
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            };

            try {
                // Upload files if any
                const files = formData.getAll('documents');
                const fileUrls = [];
                
                for (const file of files) {
                    if (file instanceof File) {
                        const storageRef = firebase.storage().ref(`assignments/${file.name}`);
                        const uploadTask = await storageRef.put(file);
                        const downloadURL = await uploadTask.ref.getDownloadURL();
                        fileUrls.push(downloadURL);
                    }
                }

                // Add file URLs to assignment data
                if (fileUrls.length > 0) {
                    assignmentData.files = fileUrls;
                }

                // Add quiz data if type is quiz
                if (assignmentData.type === 'quiz') {
                    const questions = [];
                    const questionElements = document.querySelectorAll('#quizQuestions > div');
                    
                    questionElements.forEach((element, index) => {
                        const question = {
                            text: element.querySelector('input[type="text"]').value,
                            answers: Array.from(element.querySelectorAll('input[type="text"]')).slice(1).map(input => input.value),
                            correctAnswer: Array.from(element.querySelectorAll('input[type="radio"]')).findIndex(radio => radio.checked)
                        };
                        questions.push(question);
                    });

                    assignmentData.questions = questions;
                }

                // Add Google Drive and Forms links
                if (formData.get('driveLink')) {
                    assignmentData.driveLink = formData.get('driveLink');
                }
                if (formData.get('formLink')) {
                    assignmentData.formLink = formData.get('formLink');
                }

                // Save assignment to Firestore
                await firebase.firestore().collection('assignments').add(assignmentData);
                alert('Tạo bài tập thành công');
                closeCreateAssignmentModal();
                loadAssignments();
            } catch (error) {
                console.error('Error creating assignment:', error);
                alert('Có lỗi xảy ra khi tạo bài tập');
            }
        });

        // Load courses
        function loadCourses() {
            const user = firebase.auth().currentUser;
            if (user) {
                const coursesRef = firebase.firestore().collection('courses')
                    .where('teacherId', '==', user.uid);
                
                coursesRef.get().then((querySnapshot) => {
                    const coursesContainer = document.getElementById('coursesContainer');
                    coursesContainer.innerHTML = ''; // Clear existing courses
                    
                    if (querySnapshot.empty) {
                        // Add sample courses if no courses exist
                        const sampleCourses = [
                            {
                                id: 'math3',
                                name: 'Toán lớp 3',
                                description: 'Học các phép tính cơ bản và giải toán',
                                subject: 'math',
                                grade: '3',
                                icon: 'calculator',
                                gradient: 'from-blue-500 to-blue-600'
                            },
                            {
                                id: 'literature3',
                                name: 'Tiếng Việt lớp 3',
                                description: 'Rèn luyện kỹ năng đọc viết',
                                subject: 'literature',
                                grade: '3',
                                icon: 'book-open',
                                gradient: 'from-green-500 to-green-600'
                            }
                        ];

                        sampleCourses.forEach(course => {
                            const courseCard = document.createElement('div');
                            courseCard.className = 'course-card bg-white rounded-lg shadow-md overflow-hidden';
                            courseCard.innerHTML = `
                                <div class="h-40 bg-gradient-to-r ${course.gradient} flex items-center justify-center">
                                    <i class="fas fa-${course.icon} text-white text-6xl"></i>
                                </div>
                                <div class="p-6">
                                    <h4 class="text-xl font-bold mb-2">${course.name}</h4>
                                    <p class="text-gray-600 mb-4">${course.description}</p>
                                    <div class="flex justify-between space-x-2">
                                        <button onclick="openEditCourseModal('${course.id}')" class="flex-1 bg-indigo-600 text-white py-2 rounded-lg hover:bg-indigo-700">
                                            <i class="fas fa-edit mr-2"></i> Chỉnh sửa
                                        </button>
                                        <button onclick="openDeleteCourseModal('${course.id}')" class="flex-1 bg-red-600 text-white py-2 rounded-lg hover:bg-red-700">
                                            <i class="fas fa-trash mr-2"></i> Xóa
                                        </button>
                                    </div>
                                </div>
                            `;
                            coursesContainer.appendChild(courseCard);
                        });
                    } else {
                        // Load existing courses from Firestore
                        querySnapshot.forEach((doc) => {
                            const course = doc.data();
                            const courseCard = document.createElement('div');
                            courseCard.className = 'course-card bg-white rounded-lg shadow-md overflow-hidden';
                            courseCard.innerHTML = `
                                <div class="h-40 bg-gradient-to-r from-blue-500 to-blue-600 flex items-center justify-center">
                                    <i class="fas fa-book text-white text-6xl"></i>
                                </div>
                                <div class="p-6">
                                    <h4 class="text-xl font-bold mb-2">${course.name}</h4>
                                    <p class="text-gray-600 mb-4">${course.description || 'Không có mô tả'}</p>
                                    <div class="flex justify-between space-x-2">
                                        <button onclick="openEditCourseModal('${doc.id}')" class="flex-1 bg-indigo-600 text-white py-2 rounded-lg hover:bg-indigo-700">
                                            <i class="fas fa-edit mr-2"></i> Chỉnh sửa
                                        </button>
                                        <button onclick="openDeleteCourseModal('${doc.id}')" class="flex-1 bg-red-600 text-white py-2 rounded-lg hover:bg-red-700">
                                            <i class="fas fa-trash mr-2"></i> Xóa
                                        </button>
                                    </div>
                                </div>
                            `;
                            coursesContainer.appendChild(courseCard);
                        });
                    }
                });
            }
        }

        // Load students
        function loadStudents() {
            const user = firebase.auth().currentUser;
            if (user) {
                const studentsRef = firebase.firestore().collection('users')
                    .where('role', '==', 'student')
                    .where('courses', 'array-contains', user.uid);
                
                studentsRef.get().then((querySnapshot) => {
                    const studentsTable = document.querySelector('#students table tbody');
                    studentsTable.innerHTML = ''; // Clear existing students
                    
                    querySnapshot.forEach((doc) => {
                        const student = doc.data();
                        // Add student row to the table
                        // Implementation depends on your student data structure
                    });
                });
            }
        }

        // Load assignments
        function loadAssignments() {
            const user = firebase.auth().currentUser;
            if (user) {
                const assignmentsRef = firebase.firestore().collection('assignments')
                    .where('teacherId', '==', user.uid)
                    .orderBy('dueDate', 'asc');
                
                assignmentsRef.get().then((querySnapshot) => {
                    const assignmentsTable = document.querySelector('#assignments table tbody');
                    assignmentsTable.innerHTML = ''; // Clear existing assignments
                    
                    querySnapshot.forEach((doc) => {
                        const assignment = doc.data();
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td class="px-6 py-4 whitespace-nowrap">${assignment.name}</td>
                            <td class="px-6 py-4 whitespace-nowrap">${assignment.courseId}</td>
                            <td class="px-6 py-4 whitespace-nowrap">${new Date(assignment.dueDate).toLocaleString()}</td>
                            <td class="px-6 py-4 whitespace-nowrap">${assignment.submissions || 0}/${assignment.totalStudents || 0}</td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <button onclick="openEditAssignmentModal('${doc.id}')" class="text-indigo-600 hover:text-indigo-900 mr-3">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button onclick="openDeleteAssignmentModal('${doc.id}')" class="text-red-600 hover:text-red-900">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        `;
                        assignmentsTable.appendChild(row);
                    });
                });
            }
        }

        // File upload handling
        document.querySelectorAll('input[type="file"]').forEach(input => {
            input.addEventListener('change', (e) => {
                const files = e.target.files;
                if (files.length > 0) {
                    // Handle file uploads
                    Array.from(files).forEach(file => {
                        const storageRef = firebase.storage().ref(`courses/${file.name}`);
                        const uploadTask = storageRef.put(file);

                        uploadTask.on('state_changed', 
                            (snapshot) => {
                                // Progress monitoring
                                const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                                console.log('Upload is ' + progress + '% done');
                            },
                            (error) => {
                                console.error('Upload error:', error);
                                alert('Có lỗi xảy ra khi tải lên tệp');
                            },
                            () => {
                                // Upload completed
                                uploadTask.snapshot.ref.getDownloadURL().then((downloadURL) => {
                                    console.log('File available at', downloadURL);
                                    // Add file to course data
                                });
                            }
                        );
                    });
                }
            });
        });

        // Google Drive and Forms handling
        document.querySelectorAll('button[type="button"]').forEach(button => {
            button.addEventListener('click', (e) => {
                const input = e.target.previousElementSibling;
                const url = input.value.trim();
                
                if (url) {
                    // Validate and process Google Drive/Forms URL
                    if (url.includes('drive.google.com') || url.includes('docs.google.com') || url.includes('forms.google.com')) {
                        // Add URL to course data
                        console.log('Added Google URL:', url);
                        input.value = ''; // Clear input
                    } else {
                        alert('Vui lòng nhập đúng liên kết Google Drive hoặc Google Forms');
                    }
                }
            });
        });

        // Add student functionality
        function openAddStudentModal() {
            document.getElementById('addStudentModal').classList.remove('hidden');
            loadCoursesForSelection();
        }

        function closeAddStudentModal() {
            document.getElementById('addStudentModal').classList.add('hidden');
            document.getElementById('searchResults').innerHTML = '';
            document.getElementById('selectedStudents').innerHTML = '';
            document.getElementById('studentSearch').value = '';
            selectedStudents.clear();
        }

        let selectedStudents = new Set();

        // Load courses for selection
        function loadCoursesForSelection() {
            const courseSelect = document.getElementById('courseSelect');
            courseSelect.innerHTML = '<option value="">Chọn khóa học</option>';

            firebase.firestore().collection('courses')
                .where('teacherId', '==', firebase.auth().currentUser.uid)
                .get()
                .then((querySnapshot) => {
                    querySnapshot.forEach((doc) => {
                        const course = doc.data();
                        const option = document.createElement('option');
                        option.value = doc.id;
                        option.textContent = course.name;
                        courseSelect.appendChild(option);
                    });
                });
        }

        // Search students
        document.getElementById('studentSearch').addEventListener('input', async (e) => {
            const searchTerm = e.target.value.trim();
            const searchResults = document.getElementById('searchResults');
            
            if (searchTerm.length < 2) {
                searchResults.classList.add('hidden');
                return;
            }

            try {
                const studentsSnapshot = await firebase.firestore().collection('users')
                    .where('role', '==', 'student')
                    .get();

                const results = [];
                studentsSnapshot.forEach(doc => {
                    const student = doc.data();
                    if (student.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                        student.email.toLowerCase().includes(searchTerm.toLowerCase())) {
                        results.push({
                            id: doc.id,
                            ...student
                        });
                    }
                });

                if (results.length > 0) {
                    searchResults.innerHTML = results.map(student => `
                        <div class="p-2 hover:bg-gray-100 cursor-pointer flex items-center justify-between" 
                             onclick="selectStudent('${student.id}', '${student.name}', '${student.email}')">
                            <div>
                                <div class="font-semibold">${student.name}</div>
                                <div class="text-sm text-gray-500">${student.email}</div>
                            </div>
                            <i class="fas fa-plus text-green-600"></i>
                        </div>
                    `).join('');
                    searchResults.classList.remove('hidden');
                } else {
                    searchResults.innerHTML = '<div class="p-2 text-gray-500">Không tìm thấy học sinh</div>';
                    searchResults.classList.remove('hidden');
                }
            } catch (error) {
                console.error('Search error:', error);
                searchResults.innerHTML = '<div class="p-2 text-red-500">Có lỗi xảy ra khi tìm kiếm</div>';
                searchResults.classList.remove('hidden');
            }
        });

        // Select student
        function selectStudent(id, name, email) {
            if (!selectedStudents.has(id)) {
                selectedStudents.add(id);
                const selectedStudentsDiv = document.getElementById('selectedStudents');
                const studentDiv = document.createElement('div');
                studentDiv.className = 'flex items-center justify-between p-2 border-b';
                studentDiv.setAttribute('data-student-id', id);
                studentDiv.innerHTML = `
                    <div>
                        <div class="font-semibold">${name}</div>
                        <div class="text-sm text-gray-500">${email}</div>
                    </div>
                    <button onclick="removeStudent('${id}')" class="text-red-600 hover:text-red-800">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                selectedStudentsDiv.appendChild(studentDiv);
            }
            document.getElementById('searchResults').classList.add('hidden');
            document.getElementById('studentSearch').value = '';
        }

        // Remove student
        function removeStudent(id) {
            selectedStudents.delete(id);
            const studentDiv = document.querySelector(`[data-student-id="${id}"]`);
            if (studentDiv) {
                studentDiv.remove();
            }
        }

        // Add students to course
        document.getElementById('addStudentForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const courseId = document.getElementById('courseSelect').value;
            
            if (!courseId || selectedStudents.size === 0) {
                alert('Vui lòng chọn khóa học và ít nhất một học sinh');
                return;
            }

            try {
                const batch = db.batch();
                const courseRef = db.collection('courses').doc(courseId);
                
                // Add students to course
                selectedStudents.forEach(studentId => {
                    const studentCourseRef = db.collection('student_courses').doc();
                    batch.set(studentCourseRef, {
                        studentId,
                        courseId,
                        enrolledAt: firebase.firestore.FieldValue.serverTimestamp(),
                        status: 'active'
                    });
                });

                await batch.commit();
                alert('Thêm học sinh thành công');
                closeAddStudentModal();
                loadStudents(); // Refresh students list
            } catch (error) {
                console.error('Add students error:', error);
                alert('Có lỗi xảy ra khi thêm học sinh');
            }
        });

        // Edit course functionality
        function openEditCourseModal(courseId) {
            document.getElementById('editCourseModal').classList.remove('hidden');
            loadCourseData(courseId);
        }

        function closeEditCourseModal() {
            document.getElementById('editCourseModal').classList.add('hidden');
        }

        function loadCourseData(courseId) {
            firebase.firestore().collection('courses').doc(courseId).get()
                .then((doc) => {
                    if (doc.exists) {
                        const course = doc.data();
                        document.getElementById('editCourseId').value = courseId;
                        document.getElementById('editCourseName').value = course.name;
                        document.getElementById('editCourseSubject').value = course.subject;
                        document.getElementById('editCourseGrade').value = course.grade;
                        document.getElementById('editCourseDescription').value = course.description;
                    }
                })
                .catch((error) => {
                    console.error('Error loading course:', error);
                    alert('Có lỗi xảy ra khi tải dữ liệu khóa học');
                });
        }

        // Delete course functionality
        function openDeleteCourseModal(courseId) {
            document.getElementById('deleteCourseModal').classList.remove('hidden');
            document.getElementById('deleteCourseModal').setAttribute('data-course-id', courseId);
        }

        function closeDeleteCourseModal() {
            document.getElementById('deleteCourseModal').classList.add('hidden');
            document.getElementById('deleteCourseModal').removeAttribute('data-course-id');
        }

        function confirmDeleteCourse() {
            const courseId = document.getElementById('deleteCourseModal').getAttribute('data-course-id');
            
            if (!courseId) return;

            firebase.firestore().collection('courses').doc(courseId).delete()
                .then(() => {
                    alert('Xóa khóa học thành công');
                    closeDeleteCourseModal();
                    loadCourses(); // Refresh courses list
                })
                .catch((error) => {
                    console.error('Error deleting course:', error);
                    alert('Có lỗi xảy ra khi xóa khóa học');
                });
        }

        // Handle edit course form submission
        document.getElementById('editCourseForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const courseId = document.getElementById('editCourseId').value;
            const courseData = {
                name: document.getElementById('editCourseName').value,
                subject: document.getElementById('editCourseSubject').value,
                grade: document.getElementById('editCourseGrade').value,
                description: document.getElementById('editCourseDescription').value,
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            };

            try {
                await firebase.firestore().collection('courses').doc(courseId).update(courseData);
                alert('Cập nhật khóa học thành công');
                closeEditCourseModal();
                loadCourses(); // Refresh courses list
            } catch (error) {
                console.error('Error updating course:', error);
                alert('Có lỗi xảy ra khi cập nhật khóa học');
            }
        });

        // Edit assignment functionality
        function openEditAssignmentModal(assignmentId) {
            document.getElementById('editAssignmentModal').classList.remove('hidden');
            loadAssignmentData(assignmentId);
        }

        function closeEditAssignmentModal() {
            document.getElementById('editAssignmentModal').classList.add('hidden');
        }

        function loadAssignmentData(assignmentId) {
            firebase.firestore().collection('assignments').doc(assignmentId).get()
                .then((doc) => {
                    if (doc.exists) {
                        const assignment = doc.data();
                        document.getElementById('editAssignmentId').value = assignmentId;
                        document.getElementById('editAssignmentName').value = assignment.name;
                        document.getElementById('editAssignmentCourse').value = assignment.courseId;
                        document.getElementById('editAssignmentDueDate').value = new Date(assignment.dueDate).toISOString().slice(0, 16);
                        document.getElementById('editAssignmentType').value = assignment.type;
                        document.getElementById('editAssignmentContent').value = assignment.content;
                        
                        // Load current files
                        if (assignment.files && assignment.files.length > 0) {
                            const currentFilesDiv = document.getElementById('currentFiles');
                            currentFilesDiv.innerHTML = assignment.files.map(file => `
                                <div class="flex items-center justify-between p-2 border rounded-lg mb-2">
                                    <span class="text-sm">${file.name}</span>
                                    <button type="button" class="text-red-600 hover:text-red-800" onclick="removeFile('${file.url}')">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                            `).join('');
                        }

                        // Load current video
                        if (assignment.video) {
                            const currentVideoDiv = document.getElementById('currentVideo');
                            currentVideoDiv.innerHTML = `
                                <div class="flex items-center justify-between p-2 border rounded-lg mb-2">
                                    <span class="text-sm">${assignment.video.name}</span>
                                    <button type="button" class="text-red-600 hover:text-red-800" onclick="removeVideo()">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                            `;
                        }

                        // Load Google Drive and Forms links
                        if (assignment.driveLink) {
                            document.getElementById('editDriveLink').value = assignment.driveLink;
                        }
                        if (assignment.formLink) {
                            document.getElementById('editFormLink').value = assignment.formLink;
                        }

                        // Load quiz questions if type is quiz
                        if (assignment.type === 'quiz' && assignment.questions) {
                            const quizQuestionsDiv = document.getElementById('editQuizQuestions');
                            quizQuestionsDiv.innerHTML = assignment.questions.map((question, index) => `
                                <div class="border rounded-lg p-4">
                                    <div class="flex justify-between items-center mb-2">
                                        <h3 class="font-semibold">Câu hỏi ${index + 1}</h3>
                                        <button type="button" class="text-red-600 hover:text-red-800" onclick="removeEditQuestion(this)">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                    <input type="text" value="${question.text}" class="w-full px-4 py-2 border rounded-lg mb-2">
                                    <div class="space-y-2">
                                        ${question.answers.map((answer, i) => `
                                            <div class="flex items-center">
                                                <input type="radio" name="answer${index}" ${i === question.correctAnswer ? 'checked' : ''} class="mr-2">
                                                <input type="text" value="${answer}" class="flex-1 px-4 py-2 border rounded-lg">
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            `).join('');
                        }

                        // Show/hide sections based on type
                        document.getElementById('editDocumentSection').classList.toggle('hidden', assignment.type !== 'document');
                        document.getElementById('editVideoSection').classList.toggle('hidden', assignment.type !== 'video');
                        document.getElementById('editFormSection').classList.toggle('hidden', assignment.type !== 'form');
                        document.getElementById('editQuizSection').classList.toggle('hidden', assignment.type !== 'quiz');
                    }
                })
                .catch((error) => {
                    console.error('Error loading assignment:', error);
                    alert('Có lỗi xảy ra khi tải dữ liệu bài tập');
                });
        }

        // Delete assignment functionality
        function openDeleteAssignmentModal(assignmentId) {
            document.getElementById('deleteAssignmentModal').classList.remove('hidden');
            document.getElementById('deleteAssignmentModal').setAttribute('data-assignment-id', assignmentId);
        }

        function closeDeleteAssignmentModal() {
            document.getElementById('deleteAssignmentModal').classList.add('hidden');
            document.getElementById('deleteAssignmentModal').removeAttribute('data-assignment-id');
        }

        function confirmDeleteAssignment() {
            const assignmentId = document.getElementById('deleteAssignmentModal').getAttribute('data-assignment-id');
            
            if (!assignmentId) return;

            firebase.firestore().collection('assignments').doc(assignmentId).delete()
                .then(() => {
                    alert('Xóa bài tập thành công');
                    closeDeleteAssignmentModal();
                    loadAssignments();
                })
                .catch((error) => {
                    console.error('Error deleting assignment:', error);
                    alert('Có lỗi xảy ra khi xóa bài tập');
                });
        }

        // Handle edit assignment form submission
        document.getElementById('editAssignmentForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const assignmentId = document.getElementById('editAssignmentId').value;
            const assignmentData = {
                name: document.getElementById('editAssignmentName').value,
                courseId: document.getElementById('editAssignmentCourse').value,
                dueDate: new Date(document.getElementById('editAssignmentDueDate').value),
                type: document.getElementById('editAssignmentType').value,
                content: document.getElementById('editAssignmentContent').value,
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            };

            try {
                // Handle file uploads
                const newFiles = document.querySelector('input[name="newDocuments"]').files;
                if (newFiles.length > 0) {
                    const fileUrls = [];
                    for (const file of newFiles) {
                        const storageRef = firebase.storage().ref(`assignments/${file.name}`);
                        const uploadTask = await storageRef.put(file);
                        const downloadURL = await uploadTask.ref.getDownloadURL();
                        fileUrls.push({
                            name: file.name,
                            url: downloadURL
                        });
                    }
                    assignmentData.files = fileUrls;
                }

                // Handle video upload
                const newVideo = document.querySelector('input[name="newVideo"]').files[0];
                if (newVideo) {
                    const storageRef = firebase.storage().ref(`assignments/${newVideo.name}`);
                    const uploadTask = await storageRef.put(newVideo);
                    const downloadURL = await uploadTask.ref.getDownloadURL();
                    assignmentData.video = {
                        name: newVideo.name,
                        url: downloadURL
                    };
                }

                // Handle quiz data if type is quiz
                if (assignmentData.type === 'quiz') {
                    const questions = [];
                    const questionElements = document.querySelectorAll('#editQuizQuestions > div');
                    
                    questionElements.forEach((element, index) => {
                        const question = {
                            text: element.querySelector('input[type="text"]').value,
                            answers: Array.from(element.querySelectorAll('input[type="text"]')).slice(1).map(input => input.value),
                            correctAnswer: Array.from(element.querySelectorAll('input[type="radio"]')).findIndex(radio => radio.checked)
                        };
                        questions.push(question);
                    });

                    assignmentData.questions = questions;
                }

                // Update assignment in Firestore
                await firebase.firestore().collection('assignments').doc(assignmentId).update(assignmentData);
                alert('Cập nhật bài tập thành công');
                closeEditAssignmentModal();
                loadAssignments();
            } catch (error) {
                console.error('Error updating assignment:', error);
                alert('Có lỗi xảy ra khi cập nhật bài tập');
            }
        });

        // Initialize page
        document.addEventListener('DOMContentLoaded', () => {
            loadCourses();
            loadStudents();
            loadAssignments();
        });

        // Hàm mở modal chỉnh sửa học sinh
        function openEditStudentModal(studentId) {
            document.getElementById('editStudentModal').classList.remove('hidden');
            // Điền thông tin học sinh vào form
            document.getElementById('editStudentName').value = 'Nguyễn Văn A';
            document.getElementById('editStudentEmail').value = 'nguyenvana@example.com';
            document.getElementById('editStudentGrade').value = '3';
            document.getElementById('editStudentStatus').value = 'active';
        }

        // Hàm đóng modal chỉnh sửa học sinh
        function closeEditStudentModal() {
            document.getElementById('editStudentModal').classList.add('hidden');
        }

        // Hàm mở modal xóa học sinh
        function openDeleteStudentModal(studentId) {
            document.getElementById('deleteStudentModal').classList.remove('hidden');
        }

        // Hàm đóng modal xóa học sinh
        function closeDeleteStudentModal() {
            document.getElementById('deleteStudentModal').classList.add('hidden');
        }

        // Hàm xử lý form chỉnh sửa học sinh
        async function handleEditStudentSubmit(e) {
            e.preventDefault();
            
            const studentData = {
                name: document.getElementById('editStudentName').value,
                email: document.getElementById('editStudentEmail').value,
                grade: document.getElementById('editStudentGrade').value,
                status: document.getElementById('editStudentStatus').value
            };

            try {
                // Cập nhật thông tin học sinh trong Firestore
                await db.collection('students').doc('student1').update(studentData);
                
                // Hiển thị thông báo thành công
                alert('Cập nhật thông tin học sinh thành công!');
                closeEditStudentModal();
                
                // Cập nhật lại danh sách học sinh
                loadStudents();
            } catch (error) {
                console.error('Lỗi khi cập nhật học sinh:', error);
                alert('Có lỗi xảy ra khi cập nhật thông tin học sinh');
            }
        }

        // Hàm xử lý xóa học sinh
        async function handleDeleteStudent() {
            try {
                // Xóa học sinh khỏi Firestore
                await db.collection('students').doc('student1').delete();
                
                // Hiển thị thông báo thành công
                alert('Xóa học sinh thành công!');
                closeDeleteStudentModal();
                
                // Cập nhật lại danh sách học sinh
                loadStudents();
            } catch (error) {
                console.error('Lỗi khi xóa học sinh:', error);
                alert('Có lỗi xảy ra khi xóa học sinh');
            }
        }
    </script>
</body>
</html> 
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hero Class - Admin Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .sidebar {
            width: 250px;
            transition: all 0.3s;
        }
        .main-content {
            margin-left: 250px;
            transition: all 0.3s;
        }
        .card {
            transition: transform 0.3s ease;
        }
        .card:hover {
            transform: translateY(-5px);
        }
        .progress-bar {
            height: 8px;
            border-radius: 4px;
            background-color: #e2e8f0;
        }
        .progress-bar-fill {
            height: 100%;
            border-radius: 4px;
            background-color: #4f46e5;
            transition: width 0.3s ease;
        }
        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }
    </style>
</head>
<body class="bg-gray-100">
    <!-- Sidebar -->
    <div class="sidebar fixed h-screen bg-white shadow-md">
        <div class="p-4 border-b">
            <h1 class="text-2xl font-bold text-indigo-600">Hero Class</h1>
        </div>
        <nav class="p-4">
            <ul class="space-y-2">
                <li>
                    <a href="#" class="flex items-center space-x-2 text-gray-700 hover:text-indigo-600 hover:bg-gray-100 p-2 rounded-lg">
                        <i class="fas fa-home"></i>
                        <span>Trang chủ</span>
                    </a>
                </li>
                <li>
                    <a href="#users" class="flex items-center space-x-2 text-gray-700 hover:text-indigo-600 hover:bg-gray-100 p-2 rounded-lg">
                        <i class="fas fa-users"></i>
                        <span>Quản lý người dùng</span>
                    </a>
                </li>
                <li>
                    <a href="#courses" class="flex items-center space-x-2 text-gray-700 hover:text-indigo-600 hover:bg-gray-100 p-2 rounded-lg">
                        <i class="fas fa-book"></i>
                        <span>Quản lý khóa học</span>
                    </a>
                </li>
                <li>
                    <a href="#reports" class="flex items-center space-x-2 text-gray-700 hover:text-indigo-600 hover:bg-gray-100 p-2 rounded-lg">
                        <i class="fas fa-chart-bar"></i>
                        <span>Báo cáo & Thống kê</span>
                    </a>
                </li>
            </ul>
        </nav>
        <div class="absolute bottom-0 w-full p-4 border-t">
            <button onclick="logout()" class="w-full flex items-center space-x-2 text-gray-700 hover:text-red-600 p-2 rounded-lg">
                <i class="fas fa-sign-out-alt"></i>
                <span>Đăng xuất</span>
            </button>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content p-8">
        <!-- Header -->
        <div class="flex justify-between items-center mb-8">
            <h2 class="text-3xl font-bold">Xin chào, <span id="adminName">Admin</span>!</h2>
            <div class="flex items-center space-x-4">
                <div class="relative">
                    <button class="flex items-center space-x-2 text-gray-700">
                        <i class="fas fa-bell"></i>
                        <span class="bg-red-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs">3</span>
                    </button>
                </div>
                <div class="flex items-center space-x-2">
                    <img src="https://via.placeholder.com/40" alt="Avatar" class="w-10 h-10 rounded-full">
                    <span class="font-semibold" id="adminNameShort">A</span>
                </div>
            </div>
        </div>

        <!-- Quick Stats -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="text-3xl font-bold text-indigo-600 mb-2" id="totalUsers">0</div>
                <div class="text-gray-600">Tổng số người dùng</div>
            </div>
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="text-3xl font-bold text-green-600 mb-2" id="activeUsers">0</div>
                <div class="text-gray-600">Người dùng hoạt động</div>
            </div>
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="text-3xl font-bold text-yellow-600 mb-2" id="totalCourses">0</div>
                <div class="text-gray-600">Tổng số khóa học</div>
            </div>
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="text-3xl font-bold text-red-600 mb-2" id="totalRevenue">0</div>
                <div class="text-gray-600">Doanh thu tháng</div>
            </div>
        </div>

        <!-- User System Section -->
        <section class="mb-12">
            <h3 class="text-2xl font-bold mb-6">Hệ thống người dùng</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Roles Information -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h4 class="text-lg font-semibold mb-4">Các vai trò trong hệ thống</h4>
                    <div class="space-y-4">
                        <div class="flex items-start space-x-4">
                            <div class="flex-shrink-0">
                                <div class="w-12 h-12 rounded-full bg-red-100 flex items-center justify-center">
                                    <i class="fas fa-user-shield text-red-600 text-xl"></i>
                                </div>
                            </div>
                            <div>
                                <h5 class="font-semibold text-gray-900">Admin</h5>
                                <p class="text-gray-600">Quản trị toàn bộ hệ thống, có quyền cao nhất.</p>
                            </div>
                        </div>
                        <div class="flex items-start space-x-4">
                            <div class="flex-shrink-0">
                                <div class="w-12 h-12 rounded-full bg-blue-100 flex items-center justify-center">
                                    <i class="fas fa-chalkboard-teacher text-blue-600 text-xl"></i>
                                </div>
                            </div>
                            <div>
                                <h5 class="font-semibold text-gray-900">Giáo viên</h5>
                                <p class="text-gray-600">Tạo khóa học, bài học, xem kết quả học sinh.</p>
                            </div>
                        </div>
                        <div class="flex items-start space-x-4">
                            <div class="flex-shrink-0">
                                <div class="w-12 h-12 rounded-full bg-green-100 flex items-center justify-center">
                                    <i class="fas fa-user-graduate text-green-600 text-xl"></i>
                                </div>
                            </div>
                            <div>
                                <h5 class="font-semibold text-gray-900">Học sinh</h5>
                                <p class="text-gray-600">Học bài, làm bài tập, tham gia trò chơi, chat hỗ trợ.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Authentication Features -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h4 class="text-lg font-semibold mb-4">Tính năng đăng nhập/đăng ký</h4>
                    <div class="space-y-4">
                        <div class="flex items-start space-x-4">
                            <div class="flex-shrink-0">
                                <div class="w-12 h-12 rounded-full bg-purple-100 flex items-center justify-center">
                                    <i class="fas fa-sign-in-alt text-purple-600 text-xl"></i>
                                </div>
                            </div>
                            <div>
                                <h5 class="font-semibold text-gray-900">Phương thức đăng nhập</h5>
                                <p class="text-gray-600">Email/password hoặc đăng nhập bằng Google.</p>
                            </div>
                        </div>
                        <div class="flex items-start space-x-4">
                            <div class="flex-shrink-0">
                                <div class="w-12 h-12 rounded-full bg-yellow-100 flex items-center justify-center">
                                    <i class="fas fa-user-plus text-yellow-600 text-xl"></i>
                                </div>
                            </div>
                            <div>
                                <h5 class="font-semibold text-gray-900">Đăng ký tài khoản</h5>
                                <p class="text-gray-600">Chọn vai trò khi đăng ký (Admin/Giáo viên/Học sinh).</p>
                            </div>
                        </div>
                        <div class="flex items-start space-x-4">
                            <div class="flex-shrink-0">
                                <div class="w-12 h-12 rounded-full bg-indigo-100 flex items-center justify-center">
                                    <i class="fas fa-database text-indigo-600 text-xl"></i>
                                </div>
                            </div>
                            <div>
                                <h5 class="font-semibold text-gray-900">Lưu trữ dữ liệu</h5>
                                <p class="text-gray-600">Thông tin người dùng được lưu trong Firestore Database.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Authentication Features Section -->
        <section class="mb-12">
            <h3 class="text-2xl font-bold mb-6">Tính năng đăng nhập/đăng ký</h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <!-- Email/Password Login -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <div class="flex items-center justify-center mb-4">
                        <div class="w-16 h-16 rounded-full bg-blue-100 flex items-center justify-center">
                            <i class="fas fa-envelope text-blue-600 text-2xl"></i>
                        </div>
                    </div>
                    <h4 class="text-lg font-semibold text-center mb-2">Đăng nhập bằng Email</h4>
                    <p class="text-gray-600 text-center">Sử dụng email và mật khẩu để đăng nhập vào hệ thống</p>
                    <div class="mt-4 space-y-2">
                        <div class="flex items-center text-sm text-gray-500">
                            <i class="fas fa-check-circle text-green-500 mr-2"></i>
                            <span>Xác thực email</span>
                        </div>
                        <div class="flex items-center text-sm text-gray-500">
                            <i class="fas fa-check-circle text-green-500 mr-2"></i>
                            <span>Mật khẩu được mã hóa</span>
                        </div>
                        <div class="flex items-center text-sm text-gray-500">
                            <i class="fas fa-check-circle text-green-500 mr-2"></i>
                            <span>Khôi phục mật khẩu</span>
                        </div>
                    </div>
                </div>

                <!-- Google Login -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <div class="flex items-center justify-center mb-4">
                        <div class="w-16 h-16 rounded-full bg-red-100 flex items-center justify-center">
                            <i class="fab fa-google text-red-600 text-2xl"></i>
                        </div>
                    </div>
                    <h4 class="text-lg font-semibold text-center mb-2">Đăng nhập bằng Google</h4>
                    <p class="text-gray-600 text-center">Sử dụng tài khoản Google để đăng nhập nhanh chóng</p>
                    <div class="mt-4 space-y-2">
                        <div class="flex items-center text-sm text-gray-500">
                            <i class="fas fa-check-circle text-green-500 mr-2"></i>
                            <span>Xác thực nhanh chóng</span>
                        </div>
                        <div class="flex items-center text-sm text-gray-500">
                            <i class="fas fa-check-circle text-green-500 mr-2"></i>
                            <span>Không cần nhớ mật khẩu</span>
                        </div>
                        <div class="flex items-center text-sm text-gray-500">
                            <i class="fas fa-check-circle text-green-500 mr-2"></i>
                            <span>Bảo mật cao</span>
                        </div>
                    </div>
                </div>

                <!-- Registration Process -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <div class="flex items-center justify-center mb-4">
                        <div class="w-16 h-16 rounded-full bg-green-100 flex items-center justify-center">
                            <i class="fas fa-user-plus text-green-600 text-2xl"></i>
                        </div>
                    </div>
                    <h4 class="text-lg font-semibold text-center mb-2">Quy trình đăng ký</h4>
                    <p class="text-gray-600 text-center">Đăng ký tài khoản với vai trò phù hợp</p>
                    <div class="mt-4 space-y-2">
                        <div class="flex items-center text-sm text-gray-500">
                            <i class="fas fa-check-circle text-green-500 mr-2"></i>
                            <span>Chọn vai trò khi đăng ký</span>
                        </div>
                        <div class="flex items-center text-sm text-gray-500">
                            <i class="fas fa-check-circle text-green-500 mr-2"></i>
                            <span>Xác thực thông tin</span>
                        </div>
                        <div class="flex items-center text-sm text-gray-500">
                            <i class="fas fa-check-circle text-green-500 mr-2"></i>
                            <span>Lưu trữ trong Firestore</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Data Storage Information -->
            <div class="mt-8 bg-white rounded-lg shadow-md p-6">
                <h4 class="text-lg font-semibold mb-4">Lưu trữ dữ liệu</h4>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <h5 class="font-semibold text-gray-900 mb-2">Firestore Database</h5>
                        <ul class="space-y-2 text-gray-600">
                            <li class="flex items-center">
                                <i class="fas fa-check text-green-500 mr-2"></i>
                                <span>Lưu trữ thông tin người dùng</span>
                            </li>
                            <li class="flex items-center">
                                <i class="fas fa-check text-green-500 mr-2"></i>
                                <span>Đồng bộ thời gian thực</span>
                            </li>
                            <li class="flex items-center">
                                <i class="fas fa-check text-green-500 mr-2"></i>
                                <span>Bảo mật dữ liệu</span>
                            </li>
                        </ul>
                    </div>
                    <div>
                        <h5 class="font-semibold text-gray-900 mb-2">Authentication</h5>
                        <ul class="space-y-2 text-gray-600">
                            <li class="flex items-center">
                                <i class="fas fa-check text-green-500 mr-2"></i>
                                <span>Xác thực người dùng</span>
                            </li>
                            <li class="flex items-center">
                                <i class="fas fa-check text-green-500 mr-2"></i>
                                <span>Quản lý phiên đăng nhập</span>
                            </li>
                            <li class="flex items-center">
                                <i class="fas fa-check text-green-500 mr-2"></i>
                                <span>Kiểm soát quyền truy cập</span>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- Charts Section -->
        <section id="reports" class="mb-12">
            <h3 class="text-2xl font-bold mb-6">Thống kê & Báo cáo</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- User Growth Chart -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h4 class="text-lg font-semibold mb-4">Tăng trưởng người dùng</h4>
                    <div class="chart-container">
                        <canvas id="userGrowthChart"></canvas>
                    </div>
                </div>
                
                <!-- User Distribution Chart -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h4 class="text-lg font-semibold mb-4">Phân bố người dùng</h4>
                    <div class="chart-container">
                        <canvas id="userDistributionChart"></canvas>
                    </div>
                </div>

                <!-- Course Popularity Chart -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h4 class="text-lg font-semibold mb-4">Khóa học phổ biến</h4>
                    <div class="chart-container">
                        <canvas id="coursePopularityChart"></canvas>
                    </div>
                </div>

                <!-- Revenue Chart -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h4 class="text-lg font-semibold mb-4">Doanh thu theo tháng</h4>
                    <div class="chart-container">
                        <canvas id="revenueChart"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <!-- Users Section -->
        <section id="users" class="mb-12">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold">Quản lý người dùng</h3>
                <button class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700">
                    <i class="fas fa-plus mr-2"></i> Thêm người dùng
                </button>
            </div>
            <div class="bg-white rounded-lg shadow-md overflow-hidden">
                <table class="min-w-full">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tên</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Email</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Vai trò</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Trạng thái</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Thao tác</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200" id="usersList">
                        <!-- Users will be added here -->
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Courses Section -->
        <section id="courses" class="mb-12">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold">Quản lý khóa học</h3>
                <button class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700">
                    <i class="fas fa-plus mr-2"></i> Thêm khóa học
                </button>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="coursesContainer">
                <!-- Course cards will be added here -->
            </div>
        </section>
    </div>

    <!-- Login Modal -->
    <div id="loginModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden">
        <div class="flex items-center justify-center min-h-screen">
            <div class="bg-white rounded-lg shadow-xl p-8 w-full max-w-md">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-2xl font-bold text-gray-900">Đăng nhập</h3>
                    <button onclick="closeLoginModal()" class="text-gray-400 hover:text-gray-500">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <form id="loginForm" class="space-y-4">
                    <div>
                        <label for="loginEmail" class="block text-sm font-medium text-gray-700">Email</label>
                        <input type="email" id="loginEmail" required
                            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                    </div>
                    <div>
                        <label for="loginPassword" class="block text-sm font-medium text-gray-700">Mật khẩu</label>
                        <input type="password" id="loginPassword" required
                            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                    </div>
                    <div class="flex items-center justify-between">
                        <div class="flex items-center">
                            <input type="checkbox" id="rememberMe"
                                class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded">
                            <label for="rememberMe" class="ml-2 block text-sm text-gray-900">Ghi nhớ đăng nhập</label>
                        </div>
                        <a href="#" class="text-sm text-indigo-600 hover:text-indigo-500">Quên mật khẩu?</a>
                    </div>
                    <div>
                        <button type="submit"
                            class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                            Đăng nhập
                        </button>
                    </div>
                    <div class="mt-4">
                        <button type="button" onclick="loginWithGoogle()"
                            class="w-full flex justify-center items-center py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                            <i class="fab fa-google text-red-500 mr-2"></i>
                            Đăng nhập với Google
                        </button>
                    </div>
                    <div class="text-center mt-4">
                        <span class="text-sm text-gray-600">Chưa có tài khoản?</span>
                        <button type="button" onclick="showRegisterModal()"
                            class="text-sm font-medium text-indigo-600 hover:text-indigo-500 ml-1">
                            Đăng ký ngay
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Register Modal -->
    <div id="registerModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden">
        <div class="flex items-center justify-center min-h-screen">
            <div class="bg-white rounded-lg shadow-xl p-8 w-full max-w-md">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-2xl font-bold text-gray-900">Đăng ký tài khoản</h3>
                    <button onclick="closeRegisterModal()" class="text-gray-400 hover:text-gray-500">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <form id="registerForm" class="space-y-4">
                    <div>
                        <label for="registerName" class="block text-sm font-medium text-gray-700">Họ và tên</label>
                        <input type="text" id="registerName" required
                            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                    </div>
                    <div>
                        <label for="registerEmail" class="block text-sm font-medium text-gray-700">Email</label>
                        <input type="email" id="registerEmail" required
                            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                    </div>
                    <div>
                        <label for="registerPassword" class="block text-sm font-medium text-gray-700">Mật khẩu</label>
                        <input type="password" id="registerPassword" required
                            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                    </div>
                    <div>
                        <label for="registerConfirmPassword" class="block text-sm font-medium text-gray-700">Nhập lại mật khẩu</label>
                        <input type="password" id="registerConfirmPassword" required
                            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                    </div>
                    <div>
                        <label for="registerRole" class="block text-sm font-medium text-gray-700">Vai trò</label>
                        <select id="registerRole" required
                            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                            <option value="student">Học sinh</option>
                            <option value="teacher">Giáo viên</option>
                            <option value="admin">Admin</option>
                        </select>
                    </div>
                    <div>
                        <button type="submit"
                            class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                            Đăng ký
                        </button>
                    </div>
                    <div class="text-center mt-4">
                        <span class="text-sm text-gray-600">Đã có tài khoản?</span>
                        <button type="button" onclick="showLoginModal()"
                            class="text-sm font-medium text-indigo-600 hover:text-indigo-500 ml-1">
                            Đăng nhập ngay
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_AUTH_DOMAIN",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_STORAGE_BUCKET",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);

        // Check authentication
        firebase.auth().onAuthStateChanged((user) => {
            if (user) {
                // User is signed in
                const userRef = firebase.firestore().collection('users').doc(user.uid);
                userRef.get().then((doc) => {
                    if (doc.exists) {
                        const userData = doc.data();
                        if (userData.role !== 'admin') {
                            // Redirect to appropriate dashboard
                            window.location.href = userData.role + '-dashboard.html';
                        } else {
                            // Update UI with user data
                            document.getElementById('adminName').textContent = userData.name;
                            document.getElementById('adminNameShort').textContent = userData.name.charAt(0);
                            // Load data
                            loadStats();
                            loadUsers();
                            loadCourses();
                            initializeCharts();
                        }
                    }
                });
            } else {
                // User is signed out
                window.location.href = 'index.html';
            }
        });

        // Load statistics
        function loadStats() {
            // Load total users
            firebase.firestore().collection('users').get().then((snapshot) => {
                document.getElementById('totalUsers').textContent = snapshot.size;
            });

            // Load active users (users who logged in within last 30 days)
            const thirtyDaysAgo = new Date();
            thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
            
            firebase.firestore().collection('users')
                .where('lastLogin', '>=', thirtyDaysAgo)
                .get()
                .then((snapshot) => {
                    document.getElementById('activeUsers').textContent = snapshot.size;
                });

            // Load total courses
            firebase.firestore().collection('courses').get().then((snapshot) => {
                document.getElementById('totalCourses').textContent = snapshot.size;
            });

            // Load monthly revenue
            const startOfMonth = new Date();
            startOfMonth.setDate(1);
            startOfMonth.setHours(0, 0, 0, 0);

            firebase.firestore().collection('payments')
                .where('date', '>=', startOfMonth)
                .get()
                .then((snapshot) => {
                    let total = 0;
                    snapshot.forEach(doc => {
                        total += doc.data().amount;
                    });
                    document.getElementById('totalRevenue').textContent = total.toLocaleString('vi-VN') + ' VNĐ';
                });
        }

        // Initialize charts
        function initializeCharts() {
            // User Growth Chart
            const userGrowthCtx = document.getElementById('userGrowthChart').getContext('2d');
            const userGrowthChart = new Chart(userGrowthCtx, {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Số người dùng mới',
                        data: [],
                        backgroundColor: 'rgba(79, 70, 229, 0.8)',
                        borderColor: 'rgb(79, 70, 229)',
                        borderWidth: 1,
                        borderRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        title: {
                            display: true,
                            text: 'Tăng trưởng người dùng theo tháng'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Số người dùng'
                            }
                        }
                    }
                }
            });

            // Fetch user growth data
            const sixMonthsAgo = new Date();
            sixMonthsAgo.setMonth(sixMonthsAgo.getMonth() - 6);
            
            firebase.firestore().collection('users')
                .where('createdAt', '>=', sixMonthsAgo)
                .get()
                .then((snapshot) => {
                    const monthlyData = {};
                    snapshot.forEach(doc => {
                        const date = doc.data().createdAt.toDate();
                        const monthYear = `${date.getMonth() + 1}/${date.getFullYear()}`;
                        monthlyData[monthYear] = (monthlyData[monthYear] || 0) + 1;
                    });

                    const labels = Object.keys(monthlyData).sort();
                    const data = labels.map(label => monthlyData[label]);
                    
                    userGrowthChart.data.labels = labels;
                    userGrowthChart.data.datasets[0].data = data;
                    userGrowthChart.update();
                });

            // User Distribution Chart
            const userDistributionCtx = document.getElementById('userDistributionChart').getContext('2d');
            const userDistributionChart = new Chart(userDistributionCtx, {
                type: 'bar',
                data: {
                    labels: ['Học sinh', 'Giáo viên', 'Phụ huynh', 'Admin'],
                    datasets: [{
                        label: 'Số lượng người dùng',
                        data: [0, 0, 0, 0],
                        backgroundColor: [
                            'rgba(79, 70, 229, 0.8)',
                            'rgba(16, 185, 129, 0.8)',
                            'rgba(245, 158, 11, 0.8)',
                            'rgba(239, 68, 68, 0.8)'
                        ],
                        borderColor: [
                            'rgb(79, 70, 229)',
                            'rgb(16, 185, 129)',
                            'rgb(245, 158, 11)',
                            'rgb(239, 68, 68)'
                        ],
                        borderWidth: 1,
                        borderRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        title: {
                            display: true,
                            text: 'Phân bố người dùng theo vai trò'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Số lượng'
                            }
                        }
                    }
                }
            });

            // Fetch user distribution data
            firebase.firestore().collection('users').get().then((snapshot) => {
                const roleCounts = {
                    'student': 0,
                    'teacher': 0,
                    'parent': 0,
                    'admin': 0
                };

                snapshot.forEach(doc => {
                    const role = doc.data().role;
                    if (roleCounts.hasOwnProperty(role)) {
                        roleCounts[role]++;
                    }
                });

                userDistributionChart.data.datasets[0].data = [
                    roleCounts.student,
                    roleCounts.teacher,
                    roleCounts.parent,
                    roleCounts.admin
                ];
                userDistributionChart.update();
            });

            // Course Popularity Chart
            const coursePopularityCtx = document.getElementById('coursePopularityChart').getContext('2d');
            const coursePopularityChart = new Chart(coursePopularityCtx, {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Số học sinh đăng ký',
                        data: [],
                        backgroundColor: 'rgba(79, 70, 229, 0.8)',
                        borderColor: 'rgb(79, 70, 229)',
                        borderWidth: 1,
                        borderRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        title: {
                            display: true,
                            text: 'Khóa học phổ biến'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Số học sinh'
                            }
                        }
                    }
                }
            });

            // Fetch course popularity data
            firebase.firestore().collection('student_courses')
                .get()
                .then((snapshot) => {
                    const courseCounts = {};
                    snapshot.forEach(doc => {
                        const courseId = doc.data().courseId;
                        courseCounts[courseId] = (courseCounts[courseId] || 0) + 1;
                    });

                    // Get course names
                    const coursePromises = Object.keys(courseCounts).map(courseId => 
                        firebase.firestore().collection('courses').doc(courseId).get()
                    );

                    Promise.all(coursePromises).then(courseDocs => {
                        const labels = courseDocs.map(doc => doc.data().name);
                        const data = Object.values(courseCounts);

                        coursePopularityChart.data.labels = labels;
                        coursePopularityChart.data.datasets[0].data = data;
                        coursePopularityChart.update();
                    });
                });

            // Revenue Chart
            const revenueCtx = document.getElementById('revenueChart').getContext('2d');
            const revenueChart = new Chart(revenueCtx, {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Doanh thu (triệu VNĐ)',
                        data: [],
                        backgroundColor: 'rgba(16, 185, 129, 0.8)',
                        borderColor: 'rgb(16, 185, 129)',
                        borderWidth: 1,
                        borderRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        title: {
                            display: true,
                            text: 'Doanh thu theo tháng'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Doanh thu (triệu VNĐ)'
                            }
                        }
                    }
                }
            });

            // Fetch revenue data
            const revenueStartDate = new Date();
            revenueStartDate.setMonth(revenueStartDate.getMonth() - 6);
            
            firebase.firestore().collection('payments')
                .where('date', '>=', revenueStartDate)
                .get()
                .then((snapshot) => {
                    const monthlyRevenue = {};
                    snapshot.forEach(doc => {
                        const date = doc.data().date.toDate();
                        const monthYear = `${date.getMonth() + 1}/${date.getFullYear()}`;
                        monthlyRevenue[monthYear] = (monthlyRevenue[monthYear] || 0) + doc.data().amount;
                    });

                    const labels = Object.keys(monthlyRevenue).sort();
                    const data = labels.map(label => monthlyRevenue[label] / 1000000); // Convert to millions

                    revenueChart.data.labels = labels;
                    revenueChart.data.datasets[0].data = data;
                    revenueChart.update();
                });
        }

        // Load users
        function loadUsers() {
            const usersList = document.getElementById('usersList');
            usersList.innerHTML = '';

            firebase.firestore().collection('users').get().then((snapshot) => {
                snapshot.forEach((doc) => {
                    const user = doc.data();
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="flex items-center">
                                <div class="flex-shrink-0 h-10 w-10">
                                    <img class="h-10 w-10 rounded-full" src="${user.photoURL || 'https://via.placeholder.com/40'}" alt="">
                                </div>
                                <div class="ml-4">
                                    <div class="text-sm font-medium text-gray-900">${user.name}</div>
                                </div>
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm text-gray-900">${user.email}</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-indigo-100 text-indigo-800">
                                ${user.role}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${
                                user.status === 'active' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'
                            }">
                                ${user.status === 'active' ? 'Hoạt động' : 'Không hoạt động'}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                            <button class="text-indigo-600 hover:text-indigo-900 mr-3">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="text-red-600 hover:text-red-900">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    `;
                    usersList.appendChild(row);
                });
            });
        }

        // Load courses
        function loadCourses() {
            const coursesContainer = document.getElementById('coursesContainer');
            coursesContainer.innerHTML = '';

            firebase.firestore().collection('courses').get().then((snapshot) => {
                snapshot.forEach((doc) => {
                    const course = doc.data();
                    const courseCard = document.createElement('div');
                    courseCard.className = 'bg-white rounded-lg shadow-md overflow-hidden';
                    courseCard.innerHTML = `
                        <div class="h-40 bg-gradient-to-r from-blue-500 to-blue-600 flex items-center justify-center">
                            <i class="fas fa-book text-white text-6xl"></i>
                        </div>
                        <div class="p-6">
                            <h4 class="text-xl font-bold mb-2">${course.name}</h4>
                            <p class="text-gray-600 mb-4">${course.description || 'Không có mô tả'}</p>
                            <div class="flex justify-between">
                                <button class="text-indigo-600 hover:text-indigo-900">
                                    <i class="fas fa-edit"></i> Sửa
                                </button>
                                <button class="text-red-600 hover:text-red-900">
                                    <i class="fas fa-trash"></i> Xóa
                                </button>
                            </div>
                        </div>
                    `;
                    coursesContainer.appendChild(courseCard);
                });
            });
        }

        // Logout function
        function logout() {
            firebase.auth().signOut().then(() => {
                window.location.href = 'index.html';
            }).catch((error) => {
                console.error('Logout error:', error);
            });
        }

        // Modal functions
        function showLoginModal() {
            document.getElementById('loginModal').classList.remove('hidden');
            document.getElementById('registerModal').classList.add('hidden');
        }

        function closeLoginModal() {
            document.getElementById('loginModal').classList.add('hidden');
        }

        function showRegisterModal() {
            document.getElementById('registerModal').classList.remove('hidden');
            document.getElementById('loginModal').classList.add('hidden');
        }

        function closeRegisterModal() {
            document.getElementById('registerModal').classList.add('hidden');
        }

        // Login form handler
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            try {
                const userCredential = await firebase.auth().signInWithEmailAndPassword(email, password);
                const user = userCredential.user;
                
                // Get user role from Firestore
                const userDoc = await firebase.firestore().collection('users').doc(user.uid).get();
                if (userDoc.exists) {
                    const userData = userDoc.data();
                    // Redirect based on role
                    window.location.href = userData.role + '-dashboard.html';
                }
            } catch (error) {
                console.error('Login error:', error);
                alert('Đăng nhập thất bại: ' + error.message);
            }
        });

        // Register form handler
        document.getElementById('registerForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('registerConfirmPassword').value;
            const role = document.getElementById('registerRole').value;

            if (password !== confirmPassword) {
                alert('Mật khẩu không khớp!');
                return;
            }

            try {
                // Create user in Firebase Auth
                const userCredential = await firebase.auth().createUserWithEmailAndPassword(email, password);
                const user = userCredential.user;

                // Save user data to Firestore
                await firebase.firestore().collection('users').doc(user.uid).set({
                    name: name,
                    email: email,
                    role: role,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    status: 'active'
                });

                // Redirect based on role
                window.location.href = role + '-dashboard.html';
            } catch (error) {
                console.error('Registration error:', error);
                alert('Đăng ký thất bại: ' + error.message);
            }
        });

        // Google login handler
        async function loginWithGoogle() {
            try {
                const provider = new firebase.auth.GoogleAuthProvider();
                const result = await firebase.auth().signInWithPopup(provider);
                const user = result.user;

                // Check if user exists in Firestore
                const userDoc = await firebase.firestore().collection('users').doc(user.uid).get();
                
                if (!userDoc.exists) {
                    // If new user, ask for role
                    const role = prompt('Vui lòng chọn vai trò (student/teacher/admin):');
                    if (role && ['student', 'teacher', 'admin'].includes(role)) {
                        await firebase.firestore().collection('users').doc(user.uid).set({
                            name: user.displayName,
                            email: user.email,
                            role: role,
                            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                            status: 'active'
                        });
                        window.location.href = role + '-dashboard.html';
                    } else {
                        alert('Vai trò không hợp lệ!');
                        await firebase.auth().signOut();
                    }
                } else {
                    // Existing user, redirect based on role
                    const userData = userDoc.data();
                    window.location.href = userData.role + '-dashboard.html';
                }
            } catch (error) {
                console.error('Google login error:', error);
                alert('Đăng nhập bằng Google thất bại: ' + error.message);
            }
        }
    </script>
</body>
</html> 